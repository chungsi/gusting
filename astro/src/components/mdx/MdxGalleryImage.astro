---
import type { ImageMetadata } from 'astro'
import type { HTMLAttributes } from 'astro/types'
import { Image } from 'astro:assets'

type Props = {
  src: ImageMetadata
  caption?: string
  offset?: boolean
  cover?: boolean
  backCover?: boolean
} & HTMLAttributes<'img'>

const { src, caption, offset, cover, backCover }: Props = Astro.props
---

<article class='mb-2xl'>
  <div
    class:list={[
      'shadow-xl',
      offset && '-mx-[calc(var(--space-container-offset)_-_1rem)]',
      cover && 'md:ml-[50%]',
      backCover && 'md:mr-[50%]',
    ]}
  >
    <Image src={src} alt={caption ?? ''} />
  </div>
  {
    caption && (
      <p
        class:list={[
          'text-gray-400',
          cover && 'md:ml-[calc(50%_+_var(--space-xl))]',
          // Add some space between caption and any other text
          '!mb-xl',
          // Offset to right a bit in portrait mode
          !offset ? 'md:ml-2xl' : '',
        ]}
      >
        {caption}
      </p>
    )
  }
  <div class:list={[cover && 'md:ml-[calc(50%_+_var(--space-xl))]']}>
    <slot />
  </div>
</article>
